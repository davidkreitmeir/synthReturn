---
title: "synthReturn-vignette"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{synthReturn-vignette}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(synthReturn)
```

Looking under the hood

```{r test reshaping of data}

  # set function arguments
  estwind = c(-100,-1)
  eventwind = c(0,5)
  estobs_min = 1
  eventobs_min = 1

  DT <- ret_one_evdate
  # Return variable will be denoted by r
  colnames(DT)[colnames(DT) == "ret"] <- "r"
  # date variable will be denoted by d
  colnames(DT)[colnames(DT) == "date"] <- "d"
  # event date variable will be denoted by ed
  colnames(DT)[colnames(DT) == "eventdate"] <- "ed"
  # treatment group identifier will be denoted by tid
  colnames(DT)[colnames(DT) == "treatid"] <- "tid"
  # control group identifier will be denoted by cid
  colnames(DT)[colnames(DT) == "controlid"] <- "cid"

  # convert data into 2 DTs: r_treat & r_control
  r_treat <- DT[!is.na(tid), c("tid", "d", "ed", "r")]
  r_control <- DT[!is.na(cid), c("cid", "d", "r")]

  # sort data with respect to id and time
  r_treat <- data.table::setorder(r_treat, tid, d)
  r_control <- data.table::setorder(r_control, cid, d)

  # get all event dates
  eds <- base::unique(r_treat[, .SD[1], by = tid]$ed)

  #-----------------------------------------------------------------------------
  # Check pre-process function

  test <- purrr::map(
      eds,
      get_treat_set,
      data = r_treat,
      estwind = estwind,
      eventwind = eventwind,
      estobs_min = estobs_min,
      eventobs_min = eventobs_min
    )
  
    test <- purrr::map(
      eds,
      get_control_set,
      data = r_control,
      estwind = estwind,
      eventwind = eventwind,
      estobs_min = estobs_min,
      eventobs_min = eventobs_min
    )

```
